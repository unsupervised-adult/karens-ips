# ML Detector Domain Blocking Rules
# Uses Suricata datasets for efficient matching against 345K+ domains
# Exempts RFC1918 private networks from blocking

# DNS Query Blocking (external destinations only)
drop dns any any -> !$HOME_NET any (msg:"ML Detector: Blocked DNS Query"; \
    dns.query; dataset:isset,blocked-domains, type string, load ../datasets/blocked-domains.lst; \
    classtype:policy-violation; sid:9000001; rev:2;)

# HTTP Host Blocking (external destinations only)
drop http any any -> !$HOME_NET any (msg:"ML Detector: Blocked HTTP Host"; \
    flow:established,to_server; http.host; \
    dataset:isset,blocked-domains, type string, load ../datasets/blocked-domains.lst; \
    classtype:policy-violation; sid:9000002; rev:2;)

# TLS SNI Blocking (external destinations only)
drop tls any any -> !$HOME_NET any (msg:"ML Detector: Blocked TLS SNI"; \
    tls.sni; dataset:isset,blocked-domains, type string, load ../datasets/blocked-domains.lst; \
    classtype:policy-violation; sid:9000003; rev:2;)
