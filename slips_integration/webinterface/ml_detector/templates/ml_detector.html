<div class="ml-detector-container">

  <!-- ML Detector Header -->
  <div class="row mb-4">
    <div class="col-12">
      <h2 class="text-primary">ML Ad Detector Dashboard</h2>
      <p class="text-muted">Real-time monitoring of machine learning-based ad detection</p>
    </div>
  </div>

  <!-- SLIPS Evidence Detection Stats -->
  <div class="row mb-4">
    <div class="col-12">
      <h4 class="text-primary"><i class="bi bi-shield-check"></i> SLIPS Evidence Detection</h4>
      <p class="text-muted">ML-based behavioral analysis from network flow evidence</p>
    </div>
  </div>
  <div class="row mb-4 g-3">
    <div class="col-md-3">
      <div class="card h-100 border-primary">
        <div class="card-body text-center p-4">
          <h3 class="text-muted text-uppercase mb-3 stat-label">Packets Processed</h3>
          <div class="text-primary stat-value" id="stat_total_analyzed">0</div>
        </div>
      </div>
    </div>
    <div class="col-md-3">
      <div class="card h-100 border-primary">
        <div class="card-body text-center p-4">
          <h3 class="text-muted text-uppercase mb-3 stat-label">Ads Detected</h3>
          <div class="text-danger stat-value" id="stat_ads_detected">0</div>
        </div>
      </div>
    </div>
    <div class="col-md-3">
      <div class="card h-100 border-primary">
        <div class="card-body text-center p-4">
          <h3 class="text-muted text-uppercase mb-3 stat-label">Legitimate Traffic</h3>
          <div class="text-success stat-value" id="stat_legitimate">0</div>
        </div>
      </div>
    </div>
    <div class="col-md-3">
      <div class="card h-100 border-primary">
        <div class="card-body text-center p-4">
          <h3 class="text-muted text-uppercase mb-3 stat-label">Model Accuracy</h3>
          <div class="text-info stat-value" id="stat_accuracy">0%</div>
        </div>
      </div>
    </div>
  </div>

  <!-- QUIC Stream Blocking Stats -->
  <div class="row mb-4">
    <div class="col-12">
      <h4 class="text-warning"><i class="bi bi-broadcast"></i> QUIC Stream Blocking (YouTube/Video Ads)</h4>
      <p class="text-muted">Real-time QUIC/HTTP3 stream analysis and active blocking</p>
    </div>
  </div>
  <div class="row mb-4 g-3">
    <div class="col-md-3">
      <div class="card h-100 border-warning">
        <div class="card-body text-center p-4">
          <h3 class="text-muted text-uppercase mb-3 stat-label">Streams Analyzed</h3>
          <div class="text-primary stat-value" id="stream_total_analyzed">0</div>
        </div>
      </div>
    </div>
    <div class="col-md-3">
      <div class="card h-100 border-warning">
        <div class="card-body text-center p-4">
          <h3 class="text-muted text-uppercase mb-3 stat-label">Ads Blocked</h3>
          <div class="text-danger stat-value" id="stream_ads_detected">0</div>
        </div>
      </div>
    </div>
    <div class="col-md-3">
      <div class="card h-100 border-warning">
        <div class="card-body text-center p-4">
          <h3 class="text-muted text-uppercase mb-3 stat-label">IPs Blocked</h3>
          <div class="text-warning stat-value" id="stream_ips_blocked">0</div>
        </div>
      </div>
    </div>
    <div class="col-md-3">
      <div class="card h-100 border-warning">
        <div class="card-body text-center p-4">
          <h3 class="text-muted text-uppercase mb-3 stat-label">Status</h3>
          <div class="text-success stat-value" id="stream_status" style="font-size: 1.5rem;">Unknown</div>
        </div>
      </div>
    </div>
  </div>

  <!-- Charts Row -->
  <div class="row mb-4">
    <div class="col-md-6">
      <div class="card">
        <div class="card-header bg-light">
          <h5>Detection Timeline</h5>
        </div>
        <div class="card-body">
          <canvas id="timeline_chart" height="250"></canvas>
        </div>
      </div>
    </div>
    <div class="col-md-6">
      <div class="card">
        <div class="card-header bg-light">
          <h5>Feature Importance</h5>
        </div>
        <div class="card-body">
          <canvas id="feature_importance_chart" height="250"></canvas>
        </div>
      </div>
    </div>
  </div>

  <!-- Model Information -->
  <div class="row mb-4">
    <div class="col-12">
      <div class="card">
        <div class="card-header bg-light">
          <h5>Model Architecture & Performance</h5>
        </div>
        <div class="card-body">
          <div class="row">
            <div class="col-md-6">
              <h6 class="text-primary">Core Configuration</h6>
              <table class="table table-sm table-borderless">
                <tbody>
                  <tr>
                    <th width="180">Model Type:</th>
                    <td id="model_type">-</td>
                  </tr>
                  <tr>
                    <th>Version:</th>
                    <td id="model_version">-</td>
                  </tr>
                  <tr>
                    <th>Algorithm:</th>
                    <td id="model_algorithm">-</td>
                  </tr>
                  <tr>
                    <th>Architecture:</th>
                    <td id="model_architecture">-</td>
                  </tr>
                  <tr>
                    <th>Confidence Threshold:</th>
                    <td id="model_threshold">-</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="col-md-6">
              <h6 class="text-primary">Performance Metrics</h6>
              <table class="table table-sm table-borderless">
                <tbody>
                  <tr>
                    <th width="180">Training Accuracy:</th>
                    <td id="model_training_accuracy">-</td>
                  </tr>
                  <tr>
                    <th>Validation Accuracy:</th>
                    <td id="model_validation_accuracy">-</td>
                  </tr>
                  <tr>
                    <th>False Positive Rate:</th>
                    <td id="model_fpr">-</td>
                  </tr>
                  <tr>
                    <th>Last Trained:</th>
                    <td id="model_last_trained">-</td>
                  </tr>
                  <tr>
                    <th>Training Dataset:</th>
                    <td id="model_training_dataset">-</td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
          <div class="row mt-3">
            <div class="col-md-6">
              <h6 class="text-primary">Detection Methods</h6>
              <ul id="model_detection_methods" class="list-unstyled">
                <li>-</li>
              </ul>
            </div>
            <div class="col-md-6">
              <h6 class="text-primary">Feature Extraction Details</h6>
              <table class="table table-sm table-borderless">
                <tbody>
                  <tr>
                    <th width="180">Extraction Method:</th>
                    <td id="model_feature_extraction">-</td>
                  </tr>
                  <tr>
                    <th>Detection Window:</th>
                    <td id="model_detection_window">-</td>
                  </tr>
                  <tr>
                    <th>Update Frequency:</th>
                    <td id="model_update_frequency">-</td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
          <div class="row mt-3">
            <div class="col-12">
              <h6 class="text-primary">Features Used (8 categories)</h6>
              <ul id="model_features_list" class="list-group list-group-flush">
                <li class="list-group-item">-</li>
              </ul>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Tabs for Different Views -->
  <div class="row">
    <div class="col-12">
      <ul class="nav nav-tabs" id="mlDetectorTabs" role="tablist">
        <li class="nav-item" role="presentation">
          <button class="nav-link active" id="detections-tab" data-bs-toggle="tab"
                  data-bs-target="#detections" type="button" role="tab">
            Recent Detections
          </button>
        </li>
        <li class="nav-item" role="presentation">
          <button class="nav-link" id="alerts-tab" data-bs-toggle="tab"
                  data-bs-target="#ml-alerts" type="button" role="tab">
            Alerts & Actions
          </button>
        </li>
        <li class="nav-item" role="presentation">
          <button class="nav-link" id="settings-tab" data-bs-toggle="tab"
                  data-bs-target="#settings" type="button" role="tab">
            <i class="bi bi-gear"></i> Settings
          </button>
        </li>
      </ul>

      <div class="tab-content" id="mlDetectorTabContent">
        <!-- Recent Detections Tab -->
        <div class="tab-pane fade show active" id="detections" role="tabpanel">
          <div class="card mt-3">
            <div class="card-body">
              <table id="table_detections" class="table table-striped table-hover display nowrap">
                <thead>
                  <tr>
                    <th>Timestamp</th>
                    <th>Source IP</th>
                    <th>Destination IP</th>
                    <th>Destination Port</th>
                    <th>Protocol</th>
                    <th>Classification</th>
                    <th>Confidence</th>
                    <th>Bytes</th>
                    <th>Packets</th>
                  </tr>
                </thead>
                <tbody>
                </tbody>
              </table>
            </div>
          </div>
        </div>

        <!-- Alerts & Actions Tab -->
        <div class="tab-pane fade" id="ml-alerts" role="tabpanel">

          <!-- Live Blocking Control -->
          <div class="row mb-4 mt-3">
            <div class="col-12">
              <div class="card border-warning">
                <div class="card-header bg-warning text-dark">
                  <h6 class="mb-0">üõ°Ô∏è Live Blocking Control</h6>
                </div>
                <div class="card-body">
                  <div class="row align-items-center">
                    <div class="col-md-8">
                      <h6>Automatic Blocking Status</h6>
                      <p class="text-muted small mb-0">When enabled, detected threats will be automatically blocked at the firewall level</p>
                    </div>
                    <div class="col-md-4 text-end">
                      <div class="form-check form-switch d-inline-block">
                        <input class="form-check-input large-toggle" type="checkbox" id="live_blocking_toggle">
                        <label class="form-check-label ms-2" id="blocking_status" for="live_blocking_toggle">
                          <span class="badge bg-secondary">Checking...</span>
                        </label>
                      </div>
                    </div>
                  </div>
                  <div id="blocking_status_message" class="mt-3"></div>
                </div>
              </div>
            </div>
          </div>

          <!-- Recent Alerts -->
          <div class="row mb-4">
            <div class="col-12">
              <div class="card border-danger">
                <div class="card-header bg-danger text-white">
                  <h6 class="mb-0">üö® Recent Alerts</h6>
                </div>
                <div class="card-body">
                  <div class="table-responsive">
                    <table id="table_alerts" class="table table-sm table-hover display nowrap full-width">
                      <thead>
                        <tr>
                          <th>Timestamp</th>
                          <th>Type</th>
                          <th>Severity</th>
                          <th>Source IP</th>
                          <th>Description</th>
                          <th>Confidence</th>
                        </tr>
                      </thead>
                      <tbody></tbody>
                    </table>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Detection Feedback -->
          <div class="row mb-4">
            <div class="col-12">
              <div class="card border-info">
                <div class="card-header bg-info text-white">
                  <h6 class="mb-0">üìä Detection Feedback & Model Training</h6>
                </div>
                <div class="card-body">
                  <p class="text-muted">Provide feedback on recent detections to improve model accuracy</p>
                  <div class="table-responsive">
                    <table id="feedback_table" class="table table-sm table-hover">
                      <thead>
                        <tr>
                          <th>Timestamp</th>
                          <th>Source IP</th>
                          <th>Classification</th>
                          <th>Confidence</th>
                          <th>Feedback</th>
                        </tr>
                      </thead>
                      <tbody>
                      </tbody>
                    </table>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Exception Management -->
          <div class="row mb-4">
            <div class="col-md-6">
              <div class="card border-success">
                <div class="card-header bg-success text-white">
                  <h6 class="mb-0">‚úÖ Whitelist (IPs & URLs)</h6>
                </div>
                <div class="card-body">
                  <p class="text-muted small">Trusted IPs and URLs that will never be blocked</p>
                  <div class="mb-2">
                    <label for="whitelist_ip" class="form-label small">IP Address:</label>
                    <input type="text" class="form-control form-control-sm" id="whitelist_ip" placeholder="e.g., 192.168.1.1">
                  </div>
                  <div class="mb-3">
                    <label for="whitelist_url" class="form-label small">URL/Domain:</label>
                    <input type="text" class="form-control form-control-sm" id="whitelist_url" placeholder="e.g., example.com">
                  </div>
                  <button class="btn btn-success w-100 mb-3" id="btn_add_whitelist">Add to Whitelist</button>
                  <div class="list-group" id="whitelist_items">
                    <div class="text-muted small">No whitelisted IPs or URLs</div>
                  </div>
                </div>
              </div>
            </div>
            <div class="col-md-6">
              <div class="card border-danger">
                <div class="card-header bg-danger text-white">
                  <h6 class="mb-0">üö´ Blacklist (IPs & URLs)</h6>
                </div>
                <div class="card-body">
                  <p class="text-muted small">Manually blocked IPs and URLs</p>
                  <div class="mb-2">
                    <label for="blacklist_ip" class="form-label small">IP Address:</label>
                    <input type="text" class="form-control form-control-sm" id="blacklist_ip" placeholder="e.g., 10.0.0.1">
                  </div>
                  <div class="mb-3">
                    <label for="blacklist_url" class="form-label small">URL/Domain:</label>
                    <input type="text" class="form-control form-control-sm" id="blacklist_url" placeholder="e.g., ads.example.com">
                  </div>
                  <button class="btn btn-danger w-100 mb-3" id="btn_add_blacklist">Add to Blacklist</button>
                  <div class="list-group" id="blacklist_items">
                    <div class="text-muted small">No blocked IPs or URLs</div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Manual Actions -->
          <div class="row">
            <div class="col-12">
              <div class="card border-primary">
                <div class="card-header bg-primary text-white">
                  <h6 class="mb-0">‚ö° Quick Actions</h6>
                </div>
                <div class="card-body">
                  <div class="row">
                    <div class="col-md-3">
                      <button class="btn btn-outline-primary w-100 mb-2" id="btn_clear_blocks">
                        Clear All Blocks
                      </button>
                      <small class="text-muted">Remove all firewall rules</small>
                    </div>
                    <div class="col-md-3">
                      <button class="btn btn-outline-warning w-100 mb-2" id="btn_retrain_model">
                        Retrain Model Now
                      </button>
                      <small class="text-muted">Force immediate retraining</small>
                    </div>
                    <div class="col-md-3">
                      <button class="btn btn-outline-info w-100 mb-2" id="btn_export_detections">
                        Export Detections
                      </button>
                      <small class="text-muted">Download as CSV</small>
                    </div>
                    <div class="col-md-3">
                      <button class="btn btn-outline-secondary w-100 mb-2" id="btn_view_logs">
                        View System Logs
                      </button>
                      <small class="text-muted">Show recent activity</small>
                    </div>
                  </div>
                  <div id="action_status" class="mt-3"></div>
                </div>
              </div>
            </div>
          </div>

        </div>

        <!-- Settings Tab -->
        <div class="tab-pane fade" id="settings" role="tabpanel">
          <div class="card mt-3">
            <div class="card-header bg-primary text-white">
              <h5><i class="bi bi-gear"></i> Detection Settings</h5>
              <p class="mb-0 small">Adjust detection thresholds and model parameters</p>
            </div>
            <div class="card-body">
              
              <!-- Save/Reset Buttons -->
              <div class="row mb-3">
                <div class="col-12">
                  <button id="btn_save_config" class="btn btn-success me-2">
                    <i class="bi bi-check-circle"></i> Save Configuration
                  </button>
                  <button id="btn_reset_config" class="btn btn-warning me-2">
                    <i class="bi bi-arrow-clockwise"></i> Reset to Defaults
                  </button>
                  <button id="btn_restart_service" class="btn btn-info">
                    <i class="bi bi-arrow-repeat"></i> Restart Monitor Service
                  </button>
                  <div id="config_status" class="mt-2"></div>
                </div>
              </div>

              <!-- Duration Thresholds -->
              <div class="row mb-4">
                <div class="col-12">
                  <h6 class="text-primary border-bottom pb-2">‚è±Ô∏è Duration Thresholds (seconds)</h6>
                </div>
                <div class="col-md-4">
                  <label for="streaming_min_duration" class="form-label">
                    Content Minimum Duration
                    <small class="text-muted">(videos shorter than this ignored)</small>
                  </label>
                  <input type="number" class="form-control" id="streaming_min_duration" min="10" max="600" step="10">
                </div>
                <div class="col-md-4">
                  <label for="ad_duration_min" class="form-label">
                    Ad Minimum Duration
                    <small class="text-muted">(flows shorter ignored)</small>
                  </label>
                  <input type="number" class="form-control" id="ad_duration_min" min="1" max="30" step="1">
                </div>
                <div class="col-md-4">
                  <label for="ad_duration_max" class="form-label">
                    Ad Maximum Duration
                    <small class="text-muted">(ads longer = false positive)</small>
                  </label>
                  <input type="number" class="form-control" id="ad_duration_max" min="10" max="300" step="10">
                </div>
              </div>

              <!-- Size Thresholds -->
              <div class="row mb-4">
                <div class="col-12">
                  <h6 class="text-primary border-bottom pb-2">üì¶ Size Thresholds (bytes)</h6>
                </div>
                <div class="col-md-4">
                  <label for="streaming_min_bytes" class="form-label">
                    Content Minimum Bytes
                  </label>
                  <input type="number" class="form-control" id="streaming_min_bytes" min="1000" max="100000" step="1000">
                </div>
                <div class="col-md-4">
                  <label for="streaming_min_packets" class="form-label">
                    Content Minimum Packets
                  </label>
                  <input type="number" class="form-control" id="streaming_min_packets" min="10" max="200" step="10">
                </div>
                <div class="col-md-4">
                  <label for="ad_min_bytes" class="form-label">
                    Ad Minimum Bytes
                  </label>
                  <input type="number" class="form-control" id="ad_min_bytes" min="1000" max="50000" step="1000">
                </div>
              </div>

              <!-- Detection Sensitivity -->
              <div class="row mb-4">
                <div class="col-12">
                  <h6 class="text-primary border-bottom pb-2">üéØ Detection Sensitivity</h6>
                </div>
                <div class="col-md-6">
                  <label for="duration_ratio_threshold" class="form-label">
                    Duration Ratio Threshold
                    <small class="text-muted">(ad must be &lt; X% of content)</small>
                  </label>
                  <input type="range" class="form-range" id="duration_ratio_threshold" min="0.1" max="0.5" step="0.05">
                  <div class="text-center" id="duration_ratio_value">30%</div>
                </div>
                <div class="col-md-6">
                  <label for="confidence_threshold" class="form-label">
                    Confidence Threshold
                    <small class="text-muted">(minimum to report)</small>
                  </label>
                  <input type="range" class="form-range" id="confidence_threshold" min="0.5" max="0.95" step="0.05">
                  <div class="text-center" id="confidence_value">75%</div>
                </div>
              </div>

              <!-- Protocol Settings -->
              <div class="row mb-4">
                <div class="col-12">
                  <h6 class="text-primary border-bottom pb-2">üîê Protocol & Analysis</h6>
                </div>
                <div class="col-md-3">
                  <div class="form-check form-switch">
                    <input class="form-check-input" type="checkbox" id="enable_quic_detection">
                    <label class="form-check-label" for="enable_quic_detection">
                      QUIC Detection
                    </label>
                  </div>
                </div>
                <div class="col-md-3">
                  <div class="form-check form-switch">
                    <input class="form-check-input" type="checkbox" id="enable_encrypted_analysis">
                    <label class="form-check-label" for="enable_encrypted_analysis">
                      Encrypted Analysis
                    </label>
                  </div>
                </div>
                <div class="col-md-3">
                  <div class="form-check form-switch">
                    <input class="form-check-input" type="checkbox" id="analyze_timing_patterns">
                    <label class="form-check-label" for="analyze_timing_patterns">
                      Timing Patterns
                    </label>
                  </div>
                </div>
                <div class="col-md-3">
                  <div class="form-check form-switch">
                    <input class="form-check-input" type="checkbox" id="analyze_packet_sizes">
                    <label class="form-check-label" for="analyze_packet_sizes">
                      Packet Sizes
                    </label>
                  </div>
                </div>
              </div>

              <!-- ML Parameters -->
              <div class="row mb-4">
                <div class="col-12">
                  <h6 class="text-primary border-bottom pb-2">ü§ñ ML Model Parameters</h6>
                </div>
                <div class="col-md-3">
                  <label for="n_estimators" class="form-label">
                    Number of Estimators
                    <small class="text-muted">(trees in forest)</small>
                  </label>
                  <input type="number" class="form-control" id="n_estimators" min="50" max="200" step="10">
                </div>
                <div class="col-md-3">
                  <label for="max_depth" class="form-label">
                    Maximum Tree Depth
                  </label>
                  <input type="number" class="form-control" id="max_depth" min="5" max="30" step="5">
                </div>
                <div class="col-md-3">
                  <label for="model_type_select" class="form-label">
                    Model Type
                  </label>
                  <select class="form-select" id="model_type_select" aria-label="Machine learning model type selection">
                    <option value="random_forest">Random Forest</option>
                    <option value="gradient_boosting">Gradient Boosting</option>
                  </select>
                </div>
                <div class="col-md-3">
                  <label for="cpu_cores" class="form-label">
                    CPU Cores
                    <small class="text-muted">(-1 = all)</small>
                  </label>
                  <input type="number" class="form-control" id="cpu_cores" min="-1" max="64" step="1">
                </div>
              </div>

              <!-- Training Settings -->
              <div class="row mb-4">
                <div class="col-12">
                  <h6 class="text-primary border-bottom pb-2">üìö Training Configuration</h6>
                </div>
                <div class="col-md-3">
                  <div class="form-check form-switch">
                    <input class="form-check-input" type="checkbox" id="auto_retrain">
                    <label class="form-check-label" for="auto_retrain">
                      Auto Retrain
                    </label>
                  </div>
                  <small class="text-muted">Periodically retrain model</small>
                </div>
                <div class="col-md-3">
                  <label for="retrain_interval" class="form-label">
                    Retrain Interval (hours)
                  </label>
                  <input type="number" class="form-control" id="retrain_interval" min="1" max="168" step="1">
                </div>
                <div class="col-md-3">
                  <label for="min_training_samples" class="form-label">
                    Min Training Samples
                  </label>
                  <input type="number" class="form-control" id="min_training_samples" min="50" max="1000" step="50">
                </div>
                <div class="col-md-3">
                  <div class="form-check form-switch mt-4">
                    <input class="form-check-input" type="checkbox" id="cache_predictions">
                    <label class="form-check-label" for="cache_predictions">
                      Cache Predictions
                    </label>
                  </div>
                </div>
              </div>

              <!-- Quick Presets -->
              <div class="row">
                <div class="col-12">
                  <h6 class="text-primary border-bottom pb-2">‚ö° Quick Presets</h6>
                </div>
                <div class="col-md-3">
                  <button class="btn btn-outline-primary w-100 mb-2" id="preset_aggressive">
                    <i class="bi bi-lightning"></i> More Sensitive
                  </button>
                  <small class="text-muted">Catch more ads (more false positives)</small>
                </div>
                <div class="col-md-3">
                  <button class="btn btn-outline-success w-100 mb-2" id="preset_conservative">
                    <i class="bi bi-shield-check"></i> Less Sensitive
                  </button>
                  <small class="text-muted">Fewer false positives (miss some ads)</small>
                </div>
                <div class="col-md-3">
                  <button class="btn btn-outline-info w-100 mb-2" id="preset_short_videos">
                    <i class="bi bi-clock"></i> Short Videos
                  </button>
                  <small class="text-muted">TikTok, Shorts (1min+ content)</small>
                </div>
                <div class="col-md-3">
                  <button class="btn btn-outline-warning w-100 mb-2" id="preset_quic">
                    <i class="bi bi-lock"></i> QUIC Optimized
                  </button>
                  <small class="text-muted">Encrypted traffic (timing focus)</small>
                </div>
              </div>

            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

</div>
